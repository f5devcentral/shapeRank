<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.2.0" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="Gilad Bracha" />
  <title>Shape Rank</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote {
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013";
      position: absolute;
      margin-left: -1em;
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    text-align: left;
    white-space: pre;
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko span.math-rendering {
    display:inline-block;
    width:8em;
    overflow-x:auto;
    font-size:70%;
  }
  .madoko span.math-rendering::-webkit-scrollbar {
    width:4px;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 {
    margin-top: 1.22em;
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  {
    margin-top: 1ex;
  }
  .madoko h5, .madoko h6 {
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 {
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 {
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt,
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  <link rel="stylesheet" type="text/css" href="CodeMirror/lib/codemirror.css"  class="link">
  <script src="scheduleTurn.js"  class="script"></script>
  <script src="CodeMirror/lib/codemirror.js"  class="script"></script>
  <script src="CodeMirror/addon/display/autorefresh.js"  class="script"></script>
  <script src="primordialsoup.js"  class="script"></script>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">

<div class="snippet input-math" data-math-full="true" style="display:block"><span class="math-rendering" title="Rendering math..."><span class="snippet math-display" data-math-full="true"></span></span></div>
<div class="titleblock align-center para-block" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" style="text-align:center;line-adjust:0">
<div class="title para-block" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0">Shape Rank</div>
<div class="subtitle para-block" style="font-size:x-large;margin-bottom:0.5ex;line-adjust:0">An Advanced Programming System for Machine Learning, Data Analytics and Reactive Programming</div></div>
<div class="authors align-center" style="text-align:center;width:80%;line-adjust:0"><table class="authorrow columns block" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" style="text-align:center;line-adjust:0">
<div class="authorname" style="font-size:large;line-adjust:0">Gilad Bracha</div></td></tr></tbody></table></div></div><h2 id="sec-motivation" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span>Motivation</h2><h3 id="sec-mathematical-programming-is-on-the-rise" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.1</span>.&#8194;</span>Mathematical Programming is on the Rise</h3>
<ul class="ul list-star loose">
<li class="li ul-li list-star-li loose-li">
<p>Data analytics and Machine Learning are increasingly widespread and important.
</p></li>
<li class="li ul-li list-star-li loose-li">
<p>But there is a large gap between the mathematics and the programming.  Reducing that gap can make those engaged in mathematical programming more productive.
</p></li></ul>
<h3 id="sec-array-programming" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.2</span>.&#8194;</span>Array Programming</h3>
<p class="p noindent">Array programming originated in the early 1960s with Iverson’s Turing-award winning APL.
It was two generations ahead of its time.
</p><h3 id="sec-example--dot-product" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.3</span>.&#8194;</span>Example: Dot Product</h3>
<p class="p noindent">Dot product is defined as
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$\Sigma_{i =1}^n a_i \cdot b_i$</span></span>, where <span class="math-rendering" title="Rendering math..."><span class="math-inline">$a$</span></span>, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$b$</span></span> are <span class="math-rendering" title="Rendering math..."><span class="math-inline">$n$</span></span>-vectors.
</p>
<p class="p indent">In a traditional imperative programming language, we&#39;d implement the 
above definition via something like:
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>c := 0;
for i := 1 to n { c := c + a[i]*b[i];};</code></pre>
<p class="p noindent para-continued">In ShapeRank, we write
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$reduce(+, a*b)$</span></span>
</p><div class="shapeRankEvaluator" expression = "reduce(+, 0, a*b)"></div>



<p class="p noindent">where <span class="math-rendering" title="Rendering math..."><span class="math-inline">$a$</span></span> and <span class="math-rendering" title="Rendering math..."><span class="math-inline">$b$</span></span> are given in the program below
</p><div class="programPrelude"></div>


<h3 id="sec-advantages" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.4</span>.&#8194;</span>Advantages</h3>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">Concise, clear notation, close to the underlying math
</li>
<li class="li ul-li list-star-li compact-li">Iteration is implicit, based on shape of the data
</li>
<li class="li ul-li list-star-li compact-li">No indexing errors
</li>
<li class="li ul-li list-star-li compact-li">No infinite loops
</li>
<li class="li ul-li list-star-li compact-li">Easily parallelizable
</li>
<li class="li ul-li list-star-li compact-li">Makes you think different!
</li></ul>
<h3 id="sec-array-programming-statically-typed" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.5</span>.&#8194;</span>Array Programming, Statically Typed</h3>
<p class="p noindent">Recent research shows how we can augment array programming with static 
typing, making it more  applicable to GPUs, TPUs and other accelerators.
However, that work has remained largely theoretical; it has been 
unclear how to incorporate it into a practical design.
</p><h3 id="sec-more-than-just-programming-language" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">1.6</span>.&#8194;</span>More than Just Programming Language</h3>
<p class="p noindent">We’ve seen a flowering of “Notebook” systems - Mathematica,
 Matlab, Jupyter, Observable ….
</p>
<p class="p indent">However, Notebooks have a long way to go. We seek to integrate advanced statically 
typed programming with highly interactive live programming and user 
customizable visualization and tooling
</p>
<p class="p indent">Ultimately, we want something like Medium meets Arkiv meets 
Mathematica - an open tool for both research and development 
that advances the state of the art and gives users of 
mathematical programming tools for development, collaboration 
and dissemination.
</p><h2 id="sec-examples" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span>Examples</h2><h3 id="sec-concepts" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.1</span>.&#8194;</span>Concepts</h3>
<p class="p noindent">Scalars: basic values like numbers, strings, structs
</p>
<p class="p indent">Hyperstreams: Multi-dimensional streams, e.g.,
</p><div class="shapeRankEvaluator" expression = "[1, 2, 3]"></div>


<p class="p indent">  <span class="math-rendering" title="Rendering math..."><span class="math-inline">$\begin{bmatrix}2 &amp;  4  &amp; 8 \\16 &amp; 32 &amp; 64 \end{bmatrix}$</span></span>
</p>
<p class="p indent">Written as <div class="shapeRankEvaluator" expression = "[[2, 4, 8], [16, 32, 64]]"></div>
</p>
<p class="p indent">Every hyperstream has a shape and a rank.
</p>
<p class="p indent"> The shape is a vector of numbers indicating the size of each dimension.
</p>
<p class="p indent">The rank is the number of dimensions.
</p><div class="shapeRankEvaluator" expression = "rank([1, 2, 3])"></div>

<div class="shapeRankEvaluator" expression = "rank([[2, 4, 8], [16, 32, 64]])"></div>



<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$\forall a:rank(a) = length(shape(a))$</span></span>
</p>
<p class="p indent">Scalars are hyperstreams too!
</p>
<p class="p indent">The shape of a scalar is the empty vector [].
The rank of a scalar is 0
</p><div class="shapeRankEvaluator" expression = "3"></div>

<h3 id="sec-example---extending-operations-pointwise" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.2</span>.&#8194;</span>Example : Extending Operations Pointwise</h3>
<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$ a = [1, 2, 3]$</span></span>
</p><div class="shapeRankEvaluator" expression = "-a"></div>



<p class="p noindent">Implicitly, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$map(-, a )$</span></span>.
</p><h3 id="sec-example-2--extending-n-ary-operations-pointwise" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.3</span>.&#8194;</span>Example 2: Extending N-ary Operations Pointwise</h3>
<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$ v_1 = [10, 20, 30]$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$ v_2 = [100, 200, 300]$</span></span>
</p><div class="shapeRankEvaluator" expression = "v1 + v2"></div>



<p class="p noindent">Implicitly, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$map(+, zip(v1 , v2 ))$</span></span>.
</p><h3 id="sec-example-3--replication" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.4</span>.&#8194;</span>Example 3: Replication</h3>
<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$ a = [1, 2, 3]$</span></span>
</p><div class="shapeRankEvaluator" expression = "2*a"></div>


<p class="p noindent">Equivalent to <span class="math-rendering" title="Rendering math..."><span class="math-inline">$[2, 2, 2] \cdot a$</span></span>
</p>
<p class="p indent">Implicitly, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$map(+, zip(replicate(2, [3]), a ))$</span></span>.
</p><h3 id="sec-example-4--arbitrary-rank" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.5</span>.&#8194;</span>Example 4: Arbitrary Rank</h3><div class="shapeRankEvaluator" 
  expression = 
  "[10, 20, 30] + 2 * [[1, 2, 3], [4, 5, 6], [7, 8, 9]]">
  </div>


<h2 id="sec-language-overview" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span>Language Overview</h2>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">Functional, statically typed
</li>
<li class="li ul-li list-star-li compact-li">Only formal parameters require explicit types
</li>
<li class="li ul-li list-star-li compact-li">Types may be:

<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">Hyperstream types
</li>
<li class="li ul-li list-star-li compact-li">Type variables, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$\$T$</span></span>
</li>
<li class="li ul-li list-star-li compact-li">dynamic
</li></ul></li></ul>

<p class="p noindent">Hyperstream types consist of 
</p>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">Shape (omitted for scalars)
</li>
<li class="li ul-li list-star-li compact-li">Base type (e.g., Int, Bool, record type)
</li></ul>

<p class="p noindent">Types statically capture the shape of the data - its rank and the dimensions at each rank
</p>
<ul class="ul list-star loose">
<li class="li ul-li list-star-li loose-li">
<p>Shapes are either
</p>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">Shape vectors - lists of dimensions
</li>
<li class="li ul-li list-star-li compact-li">Shape variables, @S
</li>
<li class="li ul-li list-star-li compact-li">Shape appends, S1::S2 (in restricted cases)
</li></ul>
</li>
<li class="li ul-li list-star-li loose-li">
<p>Dimensions are given between brackets. A dimension may be:
</p>
<ul class="ul list-star compact">
<li class="li ul-li list-star-li compact-li">An integer
</li>
<li class="li ul-li list-star-li compact-li">A dimension variable <span class="math-rendering" title="Rendering math..."><span class="math-inline">$\$d$</span></span>
</li>
<li class="li ul-li list-star-li compact-li">A sum of dimensions, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$d_1 + d_2$</span></span>
</li>
<li class="li ul-li list-star-li compact-li">Empty (don’t care)
</li>
<li class="li ul-li list-star-li compact-li">The unbounded dimension, ? (for streams; no sums allowed)
</li></ul>
<h3 id="sec-examples" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span>Examples</h3></li></ul>

<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$+(a: Int, b: Int): Int$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$sum(x: []Int) = reduce(+, 0, x)$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$append(a: [\$d1]\$T, b: [\$d2]\$T): [\$d1 + \$d2]\$T$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$contains(v: @S\$T, x: \$T): Bool$</span></span>
</p>
<p class="p indent">A dimension variable or sum can be used as a type; it is 
shorthand for the integer subset it denotes
</p>
<p class="p indent">Example:
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$..(start: \$d1, end: \$d1 + \$d2): [\$d2 + 1]Int$</span></span>
</p>
<p class="p indent">where <span class="math-rendering" title="Rendering math..."><span class="math-inline">$..$</span></span> is the infix range operator, which produces
a vector whose elements are the integers between its two
arguments (inclusive).
</p><div class="shapeRankEvaluator" expression = "10 .. 16"></div>



<p class="p noindent">A shape variable or append can be used as a type; It matches 
specially marked integer vectors that specify a shape
</p>
<p class="p indent">Example:
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$makeTensor(dims: @S, contents: []\$T): @S\$T$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$makeTensor(@[2, 3], [1, 2, 3, 4, 5, 6])$</span></span>
</p><div class="shapeRankEvaluator" 
  expression = "makeTensor(@[2, 3], [1, 2, 3, 4, 5, 6])">
</div>


<p class="p noindent"><br>
The use of <span class="math-rendering" title="Rendering math..."><span class="math-inline">$@$</span></span> as a prefix identifies an expression as a
shape expression. This only effects the expression&#39;s
type, not its value.
</p>
<p class="p indent">In some cases, the shape of a hyperstream cannot be captured 
statically, e.g.:
</p><div class="shapeRankEvaluator" 
  expression = 
  "mask(
    not(contains(outerProduct(
         *, 2..7, 2..7), 2..7)),  
         2..7)"></div>



<p class="p noindent">Type dynamic is useful here. A dynamically checked cast must 
be used to use it where a type other than dynamic is expected.
</p><h3 id="sec-streams-wip--tbd" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span>Streams (WIP: TBD)</h3>
<p class="p noindent">Hyperstreams can have the unbounded dimension, <span class="math-rendering" title="Rendering math..."><span class="math-inline">$?$</span></span>, denoting a stream of
 indeterminate (and potentially infinite) length.
 
</p><h2 id="sec-machine-learning" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">4</span>.&#8194;</span>Machine Learning</h2><h3 id="sec-some-common-functions-" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">4.1</span>.&#8194;</span>Some common functions:</h3>
<p class="p noindent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$\bf{func}$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$boolToFloat(b: Bool): Float = if$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$b$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$then$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$1.0$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$else$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$0.0$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$\bf{func}$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$mean(x: []Float): Float = sum(x)/length(x)$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$\bf{func}$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$softmax(x: [\$d]Float): [\$d]Float = e^x / sum(x)$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }cross\_entropy(y: [\$d]Float, y\_prime: [\$d]Float): Float = -sum(y\_prime * log(y))$</span></span>
  <br>
<span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }argmax(v: []Float]): Float =$</span></span>
<span class="math-rendering" title="Rendering math..."><span class="math-inline">$\hbox{    }fold(maxEntry, [0, -infinity], pair(v, indexes(v)))[2]\hbox{ }\bf{where}$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$maxEntry = (a: [2]Num, b: [2]Num)\{if$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$a[1] &gt; b[1]$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$then$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$a$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$else$</span></span> <span class="math-rendering" title="Rendering math..."><span class="math-inline">$b\}$</span></span>
</p>
<p class="p indent">Examples:
</p><div class="shapeRankEvaluator" 
  expression = 
  "matmul(
     [[1, 2, 3, 4], 
      [5, 6, 7, 8]], 
     [[10, 20, 30], 
      [40, 50, 60], 
      [70, 80, 90], 
      [100, 200, 300]])"></div>


<div class="shapeRankEvaluator" 
  expression = 
  "matmul(
     [[1, 2, 3, 4], 
      [5, 6, 7, 8]], 
      [10, 20, 30, 40])"></div>



<h3 id="sec-linear-classification" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">4.2</span>.&#8194;</span>Linear Classification</h3>
<p class="p noindent">The standard description of a linear classification model is
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }model(params: \{W:[\$cn][\$fn] Float, b: [\$cn] Float\}, x:)$</span></span>
<span class="math-rendering" title="Rendering math..."><span class="math-inline">$\hbox{ } = softmax(matmul(params.W,x) + params.b))$</span></span>
</p><h5 id="sec-training" class="h4" data-heading-depth="4" style="display:block">Training</h5>
<p class="p noindent">Prior to training the model, a loss function must be defined. A common formulation 
is
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }loss(params: \{ W: [\$cn][\$fn]Float, b: [$</span></span>cn]Float },
             data: [$batchSize]{x: [$fn]Float, yp: [$cn]Float}): Float =
     avg(crossEntropyLoss(data.yp, model(params, data.x)))$
     
</p>
<p class="p indent">Using this loss function, training is defined via gradient descent, starting with 
initial parameters for the model and the training data 
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }train(params: \{ W: [\$cn][\$fn]Float, b: [\$cn]Float \},$</span></span>
<span class="math-rendering" title="Rendering math..."><span class="math-inline">$\hbox{     }data: [\$batchSize]\{ x: [\$fn]Float, yp: [\$cn]Float \})$</span></span>
<span class="math-rendering" title="Rendering math..."><span class="math-inline">$\hbox{  }:\{ W: [\$cn][\$fn]Float, b: [\$cn]Float \} = gradientDescent(0.05, loss, params, data)$</span></span>
</p>
<p class="p indent">We can now train the model
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }trainedParams = fold(train, initParams, trainingSet)$</span></span>
</p>
<p class="p indent">We then reduce over an epoch, which consists of <span class="math-rendering" title="Rendering math..."><span class="math-inline">$\$bn$</span></span> batches : 
</p><h5 id="sec-testing-and-inference" class="h4" data-heading-depth="4" style="display:block">Testing and Inference</h5>
<p class="p noindent">We can now test the accuracy of the trained model thus
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">${\bf func}\hbox{ }infer(x: [\$fn]Float): Int = argmax(model(trainedParams, x))$</span></span>
</p>
<p class="p indent"><span class="math-rendering" title="Rendering math..."><span class="math-inline">$infer([[0.25, 0.65], [0.2, 0.9], [0.1, 0.1], [0.7, 0]])$</span></span>
</p><h2 id="sec-next-steps" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">5</span>.&#8194;</span>Next Steps</h2>
<p class="p noindent">Complete Implementation
</p>
<p class="p indent">High performance Compiler
</p>
<p class="p indent">Improve Tooling
</p><span data-line=""></span></div>
</body>

</html>
